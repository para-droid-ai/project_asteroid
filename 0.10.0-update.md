# Roadmap: Project Asteroid v0.10.0

This document outlines the phased development plan to reach version 0.10.0. The primary goals are to stabilize and deepen core colonist simulation mechanics and to integrate Gemini as a dynamic, god-like narrator and event director.

## Phase 1: Stabilize Core Mechanics (Needs & Motivation)

**Objective:** Refactor the colonist AI to be driven by a more robust needs system, introducing `hunger` and `boredom`. This will fix current gameplay loops broken by the initial, simple implementation.

**Progress:** `[COMPLETED]`

### Todo List:

-   [x] **Colonist Stats:** Add `hunger` and `boredom` properties to the `Colonist` type.
-   [x] **Needs Decay:** Implement logic in the game tick for hunger and boredom to change over time.
-   [x] **New Buildables:**
    -   [x] Add `Hydroponics Tray` for food production.
    -   [x] Add `Arcade Machine` for recreation.
    -   [x] Integrate new buildables into the UI (Build Menu, Legend).
-   [x] **UI Updates:**
    -   [x] Display `Hunger` and `Boredom` stats in the Colonist Inspector Panel.
    -   [x] Display stored `Food` in the main Stats Panel.
-   [x] **Priority-Based AI:**
    -   [x] Refactor colonist task selection to prioritize critical needs (e.g., eating when starving, sleeping when exhausted) over player-designated tasks.
    -   [x] Create specific tasks and behaviors for satisfying needs:
        -   [x] `EAT` task: Colonist goes to a storage zone, gets food, and consumes it.
        -   [x] `PLAY` task: Colonist goes to an Arcade Machine to reduce boredom.
-   [x] **Food Production Loop:**
    -   [x] `GROW` task: Colonists must tend to Hydroponics Trays.
    -   [x] `HARVEST` task: Colonists harvest grown food from trays.
    -   [x] `HAUL` task: Colonists haul harvested food to storage.

### Post-Completion Patches
- [x] **AI Patch:** Corrected an issue where colonists would not attempt to harvest or plant food when storage was empty, leading to starvation. The needs-driven AI now correctly prioritizes the entire food production chain.

---

## Phase 2: Gemini as The Narrator (Colony Chronology)

**Objective:** Introduce a new UI panel, the "Colony Chronology," where Gemini generates narrative text based on game events, creating a unique story for each playthrough with a subtle, paternal "god-in-the-machine" tone.

**Progress:** `[COMPLETED]`

### Todo List:

-   [x] **Gemini API Integration:**
    -   [x] Set up `@google/genai` SDK.
    -   [x] Create a secure way to handle the API key (using environment variables).
-   [x] **Narrative Direction:**
    -   [x] Define a core narrative theme inspired by the interstellar object 3I/ATLAS (a "manx" comet).
-   [x] **Initial Game Setup:**
    -   [x] On "New Game", call Gemini to generate a unique seed, colony name, asteroid name, and brief backstories for the starting colonists, all based on the new narrative theme.
    -   [x] Display this generated information at the start of the game.
-   [x] **Colony Chronology Panel:**
    -   [x] Design and implement a new UI component for the chronology log.
-   [x] **Narrative Generation (Dynamic):**
    -   [x] Create a function to periodically snapshot the current game state (colonist actions, resource levels, recent events).
    -   [x] Develop a carefully crafted prompt for Gemini that instructs it to interpret the game state and generate a log entry in the desired tone.
    -   [x] Call Gemini with the state and prompt, then display the generated text in the Chronology panel with a timestamp.
-   [x] **Narrative Acknowledgment of Death:** Gemini's prompt is now updated with information about colonist deaths, allowing it to generate appropriate chronicle entries.

---

## Phase 3: Gemini as The Event Director

**Objective:** Replace the simple random event system with a Gemini-driven one. Gemini will act as an intelligent "dungeon master," triggering events that are contextually relevant to the colony's current situation.

**Progress:** `[NOT STARTED]`

### Todo List:

-   [ ] **Event System Refactor:**
    -   [ ] Create a new function that calls Gemini at the start of each game day.
    -   [ ] The prompt will provide a summary of the colony's status (e.g., "Resources are high, but happiness is low," or "The colonists are struggling to find food").
-   [ ] **Dynamic Event Generation:**
    -   [ ] Gemini will be asked to choose or create an event appropriate for the situation (e.g., a "festive mood" event if things are going well, or a "cargo pod with food" event if they are starving).
    -   [ ] The response should be in a structured format (JSON) that the game can easily parse to trigger the event.
-   [ ] **Implement New Events:**
    -   [ ] Expand the range of possible events that Gemini can trigger.
    -   [ ] Ensure the game logic can handle these new, dynamically triggered events.
---

## Phase 4: Colony Consequences & Narrative Depth

**Objective:** Introduce deeper consequences for failing to meet colonist needs, enhancing the narrative stakes of the simulation.

**Progress:** `[IN PROGRESS]`

### Todo List:
- [x] **Deepen Resource System**
    - [x] Give `Rock` a purpose by making it mineable into a new `Stone` resource.
    - [x] Add new construction options (Stone Walls, Stone Floors) that use stone.
    - [x] Integrate `Stone` into the UI (HUD, build menu, legend).
    - [x] Add the ability to upgrade wood structures to stone.
- [ ] **Graveyard & Memorials:**
    - [ ] Automatically place a Tombstone tile when a colonist dies.
    - [ ] Display memorial information (name, lifespan, cause of death) in the Tile Inspector.
- [ ] **Stats-Based Death:**
    - [ ] Implement a system where colonists can die if their `energy` or `hunger` remains critically low for an extended period.
    - [ ] Generate a narrative log entry via Gemini to describe the colonist's passing.
- [ ] **Low-Happiness Events:**
    - [ ] If average colony happiness remains below a certain threshold for too long, trigger a special "despair" or "revolt" event.
    - [ ] This event will be a narrative game-over, where Gemini generates a final log entry describing the colony's failure (e.g., the colonists give up, turn on each other, or abandon the settlement).

---

## Phase 5: AI & Logic Polish

**Objective:** Refine colonist AI to handle complex situations more gracefully and improve overall simulation stability and API usage.

**Progress:** `[IN PROGRESS]`

### Todo List:
- [x] **Resolve AI Deadlock:** Investigate and fix the issue where colonists with multiple critical needs (e.g., zero energy and high hunger) can get stuck in a rapid task-switching loop, preventing them from addressing any need.
    - **Hotfix:** Corrected a flaw in the initial deadlock fix where colonists would freeze if their highest-priority need was unreachable, leading to death by other causes. The logic now allows them to service lower-priority needs if the primary one is blocked.
- [x] **API Call Frequency & Fallbacks:** Review and adjust the frequency of calls to the Gemini API for the Colony Chronicle to prevent hitting usage limits.
- [x] **Improved Pathfinding:** Colonist pathfinding now treats other colonists as temporary obstacles, drastically reducing traffic jams and stuck states.